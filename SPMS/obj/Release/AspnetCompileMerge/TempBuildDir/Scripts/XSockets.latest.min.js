var XSockets={Version:"3.0",Events:{onError:"0x1f4",open:"0xc8",close:"0x12e0",storage:{set:"0x190",get:"0x191",getAll:"0x192",remove:"0x193"},onBlob:"0x12d0",connection:{onclientconnect:"0xc9",onclientdisconnect:"0xca",disconnect:"0xcb"},bindings:{completed:"0x12c0"},pubSub:{subscribe:"0x12c",unsubscribe:"0x12d"}},Utils:{longToByteArray:function(n){for(var r,t=[0,0,0,0,0,0,0,0],i=0;i<t.length;i++)r=n&255,t[i]=r,n=(n-r)/256;return t},stringToBuffer:function(n){for(var i=n.length,r=new Array(i),t=0;t<i;t++)r[t]=n.charCodeAt(t)&255;return new Uint8Array(r).buffer},parseUri:function(n){for(var u,f,r,e,t={},o={port:80,relative:"/"},s=["url","scheme","host","domain","port","fullPath","path","relative","controller","query"],h=n.match(/^(?:([^:\/?#]+):)?(?:\/\/(([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?)/),i=0;i<s.length;i++)t[s[i]]=h[i];if(t.rawQuery=t.query||"",t.query){for(u={},f=t.query.split("&"),r=0;r<f.length;r++)e=f[r].split("="),u[e[0]]=e[1];t.query=u}else t.query={};return t=XSockets.Utils.extend(o,t),t.absoluteUrl=t.scheme+"://"+t.domain+":"+t.port+o.relative+t.controller,t},randomString:function(n){for(var t="",i;t.length<n&&n>0;)i=Math.random(),t+=String.fromCharCode(Math.floor(i*26)+(i>.5?97:65));return t},getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+n+"=([^&#]*)",r=new RegExp(i),t=r.exec(window.location.search);return t==null?"":decodeURIComponent(t[1].replace(/\+/g," "))},extend:function(n,t){var i,r;if(arguments.length>2)for(i=1;i<arguments.length;i++)this.extend(n,arguments[i]);else for(r in t)n[r]=t[r];return n},guid:function(n,t){for(t=n="";n++<36;t+=n*51&52?(n^15?8^Math.random()*(n^20?16:4):4).toString(16):"-");return t}}};XSockets.Callback=function(){function n(n,t,i){this.name=n;this.fn=t;this.state=i;this.id=XSockets.Utils.guid()}return n}();XSockets.Subscription=function(){function n(n){this.Name=n;this.Callbacks=[];this.addCallback=function(t,i){this.Callbacks.push(new XSockets.Callback(n,t,i))};this.removeCallback=function(n){this.Callbacks.splice(n,1)};this.fireCallback=function(n,t,i){this.Callbacks[i].fn(n);typeof this.Callbacks[i].state=="object"&&typeof this.Callbacks[i].state.options!="undefined"&&typeof this.Callbacks[i].state.options.counter!="undefined"&&(this.Callbacks[i].state.options.counter.messages--,this.Callbacks[i].state.options.counter.messages===0&&typeof this.Callbacks[i].state.options.counter.completed=="function"&&this.Callbacks[i].state.options.counter.completed())};this.fireCallbacks=function(n,t){for(var i=0;i<this.Callbacks.length;i++)this.fireCallback(n,t,i)}}return n}();XSockets.Subscriptions=function(){function n(){this.subscriptions=[];this.add=function(n,t,i){var r,u;return(n=n.toLowerCase(),r=this.get(n),r===null)?(u=new XSockets.Subscription(n),u.addCallback(t,i),this.subscriptions.push(u),1):(r.addCallback(t,i),r.Callbacks.length)};this.get=function(n){if(typeof n!="undefined"){n=n.toLowerCase();for(var t=0;t<this.subscriptions.length;t++)if(this.subscriptions[t].Name===n)return this.subscriptions[t];return null}};this.getAll=function(){return this.subscriptions};this.remove=function(n,t){n=n.toLowerCase();for(var i=0;i<this.subscriptions.length;i++)if(this.subscriptions[i].Name===n)return this.subscriptions[i].Callbacks.splice(t,1),this.subscriptions[i].Callbacks.length===0&&this.subscriptions.splice(i,1),!0;return!1};this.fire=function(n,t,i,r){if(typeof n!="undefined"){n=n.toLowerCase();for(var u=0;u<this.subscriptions.length;u++)this.subscriptions[u].Name===n&&(r===undefined?this.subscriptions[u].fireCallbacks(t,i):this.subscriptions[u].fireCallback(t,i,r))}}}return n}();XSockets.Message=function(){function n(n,t){this.event=n;this.data=t;this.JSON={event:n,data:JSON.stringify(t)}}return n.prototype.toString=function(){return JSON.stringify(this.JSON)},n}();XSockets.BinaryMessage=function(){function n(n,t,i){var r,u;if(!window.Uint8Array)throw"Unable to create a XSockets.BinaryMessage, the browser does not support Uint8Array";if(arguments.length===3)r=n.toString(),this.id=new XSockets.Utils.guid,this.header=new Uint8Array(XSockets.Utils.longToByteArray(r.length)),this.buffer=this.appendBuffer(this.appendBuffer(this.header,this.stringToBuffer(r)),t),i&&i(this);else if(arguments.length===2){u=new Uint8Array(n,0,8);byteArrayToLong=function(n){for(var t=0,i=n.byteLength-1;i>=0;i--)t=t*256+n[i];return t};var e=byteArrayToLong(u),f=8+byteArrayToLong(u),o=new Uint8Array(n,f,n.byteLength-f),r=new Uint8Array(n,8,e);function s(n){return String.fromCharCode.apply(null,new Uint16Array(n))}t(JSON.parse(s(r)),o)}}return n.prototype.stringToBuffer=function(n){for(var i=n.length,r=new Array(i),t=0;t<i;t++)r[t]=n.charCodeAt(t)&255;return new Uint8Array(r).buffer},n.prototype.appendBuffer=function(n,t){var i=new Uint8Array(n.byteLength+t.byteLength);return i.set(new Uint8Array(n),0),i.set(new Uint8Array(t),n.byteLength),i.buffer},n.prototype.getHeader=function(){return this.header},n}();XSockets.WebSocket=function(){function n(n,t,i){var r=this,f,u;this.id=XSockets.Utils.guid();this.subscriptions=new XSockets.Subscriptions;f=function(n){var t="?";for(var i in n)t+=i+"="+encodeURIComponent(n[i])+"&";return t.slice(0,t.length-1)};this.dispatchEvent=function(n,t){if(r.subscriptions.get(n)!==null){if(typeof t=="string")try{t=JSON.parse(t)}catch(i){}r.subscriptions.fire(n,t,function(){})}};this.getClientType=function(){return typeof window.WebSocket=="undefined"?"Fallback":"WebSocket"in window&&window.WebSocket.CLOSED>2?"RFC6455":"Hixie"};this.options=XSockets.Utils.extend({parameters:{},binaryType:"arraybuffer"},typeof t=="object"&&!i?t:i);this.uri=XSockets.Utils.parseUri(n);"WebSocket"in window&&window.WebSocket&&(this.getClientType()==="Fallback"?this.webSocket=new window.WebSocket(n,t):(u=window.localStorage.getItem("XSocketsClientStorageGuid"+r.uri.controller)!==null?window.localStorage.getItem("XSocketsClientStorageGuid"+r.uri.controller):null,u!==null&&(r.uri.query.XSocketsClientStorageGuid=u),n=r.uri.absoluteUrl+f(XSockets.Utils.extend(this.options.parameters,r.uri.query)),this.webSocket=new window.WebSocket(n,t||"XSocketsNET"),this.webSocket.binaryType=this.options.binaryType));this.webSocket!==null&&(this.bind(XSockets.Events.open,function(n){var i,t,u;for(r.connection=XSockets.Utils.extend(n,{clientType:r.getClientType()}),window.localStorage.setItem("XSocketsClientStorageGuid"+r.uri.controller,n.StorageGuid),i=r.subscriptions.getAll(),t=0;t<i.length;t++)for(u=0;u<i[t].Callbacks.length;u++)if(i[t].Callbacks[u].state.ready===0){if(i[t].Callbacks[u].state.options&&(i[t].Name,i[t].Callbacks[u].state.options.hasOwnProperty("skip")))continue;r.trigger(new XSockets.Message(XSockets.Events.pubSub.subscribe,{Event:i[t].Name,Confirm:i[t].Callbacks[u].state.confirm}))}if(r.dispatchEvent(XSockets.Events.bindings.completed,r.subscriptions.getAll()),typeof r.onopen=="function")r.onopen(n)},{skip:!0}),this.webSocket.onerror=function(n){if(r.onerror)r.onerror(n);r.dispatchEvent(XSockets.Events.onError,n)},this.webSocket.onclose=function(n){if(r.onclose)r.onclose(n);r.dispatchEvent("close",n)},this.webSocket.onopen=function(n){r.dispatchEvent("open",n)},this.webSocket.onmessage=function(n){if(typeof n.data=="string"){var t=JSON.parse(n.data);if(r.dispatchEvent(t.event,t.data),t.event===XSockets.Events.onError){if(typeof r.onmessage=="function")r.onmessage(n);if(r.onerror)r.onerror(n.data,n);r.dispatchEvent(XSockets.Events.onError,JSON.parse(n.data))}}else{if(r.onblob)r.onblob(n.data);r.dispatchEvent(XSockets.Events.onBlob,n.data)}})}return n.prototype.readyState=function(){return this.webSocket.readyState},n.prototype.onblob=undefined,n.prototype.onopen=undefined,n.prototype.onclose=undefined,n.prototype.onmessage=undefined,n.prototype.onerror=undefined,n.prototype.removeCallback=function(n,t){var i=n.toLowerCase();return this.subscriptions.remove(i,t)},n.prototype.channel={},n.prototype.connection={},n.prototype.close=function(n){this.trigger(XSockets.Events.connection.disconnect,{},n)},n.prototype.getSubscriptions=function(){return this.subscriptions.subscriptions},n.prototype.bind=function(n,t,i,r){var f=this,u={options:(i instanceof Function)?{}:i,ready:this.webSocket.readyState,confirm:(r||i)instanceof Function};return u.ready===1&&this.trigger(new XSockets.Message(XSockets.Events.pubSub.subscribe,{Event:n,Confirm:u.confirm})),t instanceof Function?this.subscriptions.add(n,t,u):t instanceof Array&&t.forEach(function(t){f.subscriptions.add(n,t,u)}),(typeof r=="function"||typeof i=="function")&&this.subscriptions.add("__"+n,r||i,{options:{ready:2}}),this},n.prototype.on=function(n,t,i,r){return this.bind(n,t,i,r)},n.prototype.subscribe=function(n,t,i,r){return this.bind(n,t,i,r)},n.prototype.many=function(n,t,i,r,u){var f=this;return this.bind(n,i,XSockets.Utils.extend({counter:{messages:t,completed:function(){f.unbind(n)}}},r),u||r),this},n.prototype.one=function(n,t,i,r){var u=this;return this.bind(n,t,XSockets.Utils.extend({counter:{messages:1,completed:function(){u.unbind(n)}}},i),r||i),this},n.prototype.unbind=function(n,t){return this.subscriptions.remove(n)&&this.trigger(new XSockets.Message(XSockets.Events.pubSub.unsubscribe,{Event:n})),t&&typeof t=="function"&&t(),this},n.prototype.unsubscribe=function(n,t){return this.unbind(n,t)},n.prototype.off=function(n,t){return this.unbind(n,t)},n.prototype.trigger=function(n,t,i){if(typeof n!="object"&&(arguments.length!==2||typeof t!="function"?arguments.length===1&&(t={}):(i=t,t={})),typeof n!="object"){n=n.toLowerCase();var r=new XSockets.Message(n,t);this.webSocket.send(r.toString());i&&typeof i=="function"&&i()}else this.webSocket.send(n.toString()),t&&typeof t=="function"&&t();return this},n.prototype.publish=function(n,t,i){return this.trigger(n,t,i)},n.prototype.emit=function(n,t,i){return this.trigger(n,t,i)},n.prototype.send=function(n){return this.webSocket.send(n),this},n.prototype.triggerBinary=function(n){return this.send(n)},n.prototype.setProperty=function(n,t){var i="set_"+n;this.publish(i,typeof t=="object"?t:{value:t})},n.prototype.setEnum=function(n,t){var i="set_"+n;this.publish(i,t)},n}();XSockets.Channel=function(){function n(){}return n.prototype.create=function(n,t,i){var r=XSockets.Utils.parseUri(n),u=XSockets.Utils.guid(),f=r.absoluteUrl+"/"+u,e=new XSockets.WebSocket(f,t,XSockets.Utils.extend(r.query,i));return e.channel={Id:u,args:[f,t,XSockets.Utils.extend(r.query,i)]},e},n.prototype.connect=function(n){return new XSockets.WebSocket(n.args[0],n.args[1],n.args[2])},n}();
/*
//# sourceMappingURL=XSockets.latest.min.js.map
*/